import telebot
import requests
import urllib.parse

# Token bot
TOKEN = "8458566047:AAFYXAIaN0c5QeOQhCP97QwYZj0CBb75OyI"
bot = telebot.TeleBot(TOKEN)

API_URL = "https://api.zeidteam.xyz/ai/chatgpt4?prompt="

# ‚ùó X√≥a webhook tr∆∞·ªõc khi ch·∫°y polling ƒë·ªÉ tr√°nh l·ªói 409
bot.remove_webhook()

@bot.message_handler(commands=['ask'])
def ask_ai(message):
    try:
        query = message.text.replace("/ask", "").strip()
        print(query)
        if not query:
            bot.reply_to(message, "‚ö†Ô∏è Vui l√≤ng nh·∫≠p c√¢u h·ªèi sau l·ªánh /ask.")
            return

        prompt_encoded = urllib.parse.quote(query)
        response = requests.get(API_URL + prompt_encoded, timeout=10).json()

        if response.get("status"):
            answer = response.get("response", "Kh√¥ng c√≥ c√¢u tr·∫£ l·ªùi.")
        else:
            answer = "‚ùå API kh√¥ng tr·∫£ l·ªùi ƒë∆∞·ª£c."

        bot.reply_to(message, answer)

    except Exception as e:
        bot.reply_to(message, f"‚ö†Ô∏è L·ªói: {e}")

print("üöÄ Bot ƒëang ch·∫°y...")
bot.infinity_polling(none_stop=True, timeout=60)
